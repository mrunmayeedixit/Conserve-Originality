Abstract—We address the problem of estimating the number of people in a room using information available in standard HVAC systems. We propose an estimation scheme based on two phases. In the first phase, we assume the availability of pilot data and iden-tify a model for the dynamic relations occurring between occu-pancy levels,     concentration and room temperature. In the second phase, we make use of the identified model to formulate the occupancy estimation task as a deconvolution problem. In par-ticular, we aim at obtaining an estimated occupancy pattern by trading off between adherence to the current measurements and regularity of the pattern. To achieve this goal, we employ a spe-cial instance of the so-called fused lasso estimator, which promotes piecewise constant estimates by including an    norm-dependent term in the associated cost function. We extend the proposed esti-mator to include different sources of information, such as actuation of the ventilation system and door opening/closing events. We also provide conditions under which the occupancy estimator provides correct estimates within a guaranteed probability. We test the esti-mator running experiments on a real testbed, in order to compare it with other occupancy estimation techniques and assess the value of having additional information sources.Note to Practitioners—Home automation systems benefit from automatic recognition of human presence in the built environment. Since dedicated hardware is costly, it may be preferable to de-tect occupancy with software - based systems which do not require the installation of additional devices. The object of this study is the reconstruction of occupancy patterns in a room using mea-surements of     concentration, temperature, fresh air inflow, and door opening/closing events. All these signals are information sources often available in HVAC systems of modern buildings and homes. We assess the value of such information sources in terms of their relevance in detecting occupancy in small and medium-sized rooms. The proposed estimation scheme is composed of two dis-tinct phases. The first is a training phase where the goal is to de- rive a mathematical model relating the number of occupants with the     concentration. It is required to record the actual occu-pants in the room for a time period spanning few days, a task that can be performed either with manual logging or with temporary dedicated hardware counting systems. In a second phase, we use the derived model to design an online software which collects mea-surements of the environmental signals and provides the number of people currently in the room. The estimated occupancy levels can then be employed to enhance the efficiency of the HVAC system of the building. We notice that, in modern residential buildings com-posed by structurally equal flats, the training phase can be run in one flat only, since the obtained model will be reasonably valid for the other flats.I Index Terms—Deconvolution, occupancy estimation, regulariza-tion, system identification. INTRODUCTION A. Motivations and Objective M ONITORING the number of occupants of rooms is important  for  home  automation  applications,  e.g., to  automate  the  control  of  lighting,  thermostats,  security locks, and home entertainment systems [1]–[3]. It is also a key enabling factor for improving energy efficiency in smart buildings: it has been shown in [4] the exact knowledge of the building occupancy may decrease the annual energy con-sumptions of about 10%–42% by optimizing the performance of Air Conditioning (HVAC) systems (see also [5] and [6]). Direct experience indicates that some standard off- the-shelf dedicated hardware for occupancy estimation (such as cameras and radio-frequency identification (RFID) tags) suffer from several problems. First, they may be insufficiently accurate for the employment in HVAC control systems. Second, they may induce large additional deployment and maintenance costs. Last, they may have installation feasibility problems in old buildings. Moreover, hardware-based occupancy detectors may trigger privacy concerns [7]. Consequently, it is interesting to study how and to what extent hardware-based people counters can be replaced by software-based occupancy estimators that only employ available information in standard HVAC systems (such as     concentration and temperature), which informa-tion sources have to be considered, and what type of statistical processing leads to efficient estimators.The main objective of this paper is to address the above ques-tions by proposing occupancy estimators that give information on the number of occupants using commonly available signals, namely, measurements of     concentration and temperature, HVAC actuation levels (i.e., the amount of fresh air injected in a room), and information on door opening/closing events.B. Related Work The currently available techniques for monitoring the occu-pancy in rooms and buildings can be categorized into hard-ware-based and model-based approaches. The first category includes methods working with dedicated hardware. For instance, [5] and [8] deploy networks of cam-eras detecting people crossing a determined area under surveil-lance, whereas [9]–[11], utlilize RFIDs; see also [12] for a re-cent survey. As mentioned before, dedicated hardware may be expensive and applicable only to certain situations, due to poten-tial drawbacks (privacy or others). For example, [13] uses inex-pensive magnetic reed switches and passive infra red (PIR) sen-sors, but the method cannot provide the exact number of people, detecting only whether a room is occupied or not. The second category exploits the fact that occupants affect the indoor environment by emitting, heat and humidity. Thus, occupancy is inferred indirectly using dynamical models that relate environmental signals with occupancy. These models may be obtained by employing data-driven techniques (i.e., identification-based methods) or by exploiting knowledge of the underlying physical laws (i.e., physics-based methods). The latter techniques comprise strategies based on mass balance equations or first principle considerations to derive dynamical models relating the number of occupants,     concentration, temperature and humidity [14]–[17]. Identification-based ap-proaches aim at constructing input–output models from datasets of past measured data. Using the obtained model, the number of occupants is estimated by inverting the     dynamics [18]–[20]. The same idea is at the base of black-box machine learning techniques such as support vector machines (SVMs), neural networks (NNs), and hidden Markov models (HMMs).For instance, in [21], information regarding     concentration and data acquired by acoustic and passive infrared sensors are employed to estimate the number of occupants in an office using SVMs, NNs, and HMMs. Other proposed approaches es-timate the occupancy using other features (e.g., averages of the signals in time, first-/second-order temporal differences), see [22] and [23]. In [24], an autoregressive hidden Markov model (ARHMM) is developed to estimate occupancy levels based on environmental signal measurements also taking into account their correlation. The strategy is further developed in [25], where the technique is integrated with a wireless sensor network and tested in a research laboratory. A different solution is studied in [26], where occupancy is inferred from electricity consumption.C. Statement of Contributions This paper, extension of [27], describes and analyzes from theoretical perspectives a two- tier software-based occupancy estimation scheme. The first tier assumes the availability of both environmental signals and true occupancy levels (as pilot data) for a short and well defined period of time. The data regarding occupancy may come from manual logging, or from dedicated temporary people counting hardware. Black-box modeling is then used to model the room under consideration, i.e., no other a priori knowledge on the room properties is assumed. The second tier formulates the occupancy estimation problem as an inverse problem, i.e., it searches for the occupancy pattern that best explains the measured data given the identified model. In this tier, we exploit the fact that the occupancy signal is piece-wise constant and integer, in order to formulate the estimation problem within a fused-lasso framework [28]. A contribution of the manuscript is to derive different estima-tors based on the availability of the various information sources. More specifically, we consider the case of adding knowledge of HVAC actuation signals (how much air is injected in the room). We also study the case of adding a boolean signal accounting for door opening/closing events and derive theoretical statis-tical properties of the strategy, which have not been considered in [27]. More precisely, we compute bounds on the probability of obtaining incorrect estimates, given the levels of measure-ment noise, the identified model and the design parameters of the estimators. The proposed method is then employed to estimate the number of people in a medium -sized room instrumented as a university laboratory. Even if our tests are performed in a laboratory, we notice that there is no limitation in using the method in other rooms: the strategy is suitable for any kind of home or office environment as long as standard HVAC mea-surements are available. Moreover, in buildings with same-size flats one can perform the training phase in only one flat since the obtained model can be employed to design the occupancy estimator for the other flats. Therefore, the method is suitable for estimation of occupancy patterns in such buildings. D. Structure of the Manuscript Section II formulates the mathematical problem and the solution methodology. Sections III and IV describe, respec-tively, how to identify the model of the room from a training set, and how to exploit this model for estimation purposes. Section V characterizes the performance of the estimator from a statistical perspective. Section VI describes how to modify the original estimation strategy when considering also HVAC actuation levels and information on door opening and closing. Section VII introduces the considered estimation performance indexes, the experimental setup, the results of the estimation processes, and some comparisons with standard tools of Ma-chine Learning. Section VIII then wraps some conclusions, remarks, and ideas for future directions. Proofs are collected in the Appendix. II. PROBLEM DEFINITION AND METHODOLOGY We consider a schematic representation of the dynamics of the concentration of the     and temperature in a room under well-mixed air assumptions (i.e., these quantities are assumed to be spatially constant). In Fig. 1,represents the concentra-tion of,the temperature, the amount of injected fresh air, the occupancy, all at time represents an ini-tially unknown dynamic system relating disturbances, events, ventilation and building occupancy levels with temperature and concentration signals. In addition, we consider a variable which is a Boolean measurement of door opening and closing events, defined as follows: The problem we consider in this paper is to find an effective algorithm that transforms measurements of The first phase addresses a system identification problem, while the second phase addresses a deconvolution problem. A contribution of this paper is the characterization of the pro-posed estimator in terms of detection error, i.e., probability of obtaining wrong estimates as a function of the parameters of the estimator. We also study extensions of the estimator to in-clude does not change the struc-ture and main properties of the estimator, accounting for door opening and closing requires some modifications of the problem by adding suitable constraints. III IDENTIFICATION OF THE ROOM MODEL In this section, we describe how to obtain a model for   starting from pilot data of As in [29]–[33], we assume the environmental signals to be stochastic processes, the dynamics of the room to be discrete LTI, measurement devices to be synchronized and operating at the same sample time. We further assume that    samples of the aforementioned signals have been collected during an ex-perimental phase.The dynamics of the room can be expressed as where without loss of generality are matrix polynomials with all the entries having the same order. The processes      and       are white Gaussian noises, independent of each other, representing the innovation process, i.e., part of and that cannot be predicted from past measurements. To estimate the polynomials and we con-sider a prediction error method (PEM) paradigm. We define the best linear one-step-ahead predictor of the outputs, namely obtained by simply neglecting the noise processes. Then, using PEM-based techniques we can obtain and, such that the variance of the prediction errors and on the data collected during the training phase, is minimized. From (3), it follows that the predictors and exploit the same information of the past. Fig. 2 plots the correlation functions defined in (4), and com-puted using the dataset considered throughout the manuscript. In (4)and represent signals stripped of the mean,   is a time lag, and    denotes the size of the dataset The functions and indicate the dependency of the occupancy signal on the     concentration and tempera-ture, respectively, as a function of the time lag  . It can be promptly seen that the signal mostly correlated with the occu-pancy is the level. For this reason, in the rest of this paper,we shall consider only the predictor and thus focus on the identification of. A. Nonparametric Identification of the Dynamics In this paper, we adopt a nonparametric approach to the problem of identifying the     room dynamics. Instead of directly searching for the coefficients of the polynomials,and we aim at estimating the system impulse responses, which are defined in the time domain and which are related to the frequency domain description of the system through the relation where are the impulse responses having the occupancy, temperature and     as inputs, respectively. We can simplify the problem by truncating the impulse response to a fixed large index   and estimate the first   coefficients of each impulse response. The estimated coefficients can then be used to form polynomials1 that well-approximate the transfer functions. To make the estimation problem well-posed, we define a suit-able hypothesis space for the unknown impulse responses. Such a space is a reproducing kernel Hilbert space (RKHS) [34], and its associated kernel is the so-called stable spline kernel [35], [36], defined as where   is a hyperparameter tuning the decay rate. The choice of this kernel is motivated by the fact that the associated RKHS contains smooth and exponentially decaying functions. These are desirable properties in impulse responses modeling of phys-ical systems such as those considered in this problem. We refer to [37] for a thorough description of kernel based methods in system identification. i.e., as regularized least-squares (LS), where with   a positive definite weighting ma-trix penalizing candidate impulse responses which do not decay to zero for large values of the time index. In this way,   favors outcomes   that well represent impulse responses of stable systems. Here, we set the matrix   as       ; the choice of the hyperparameter   is discussed below. is a positive real number representing a tradeoff between variance and bias of the estimator, leading to the LS esti-mate of	for The optimal values of   and   can be computed using either cross validation [38] or empirical Bayes techniques [39], [35].1In this paper, we set can be computed given the available information. Thus (12) be-come (13) which shows that the problem of estimating the unknown occupancy pattern is a deconvolution problem, i.e., the signal can be estimated as the signal best describing the observed output     , given the knowledge of the transfer function   .Since      is assumed white and Gaussian, the natural approach to this problem would be to employ a LS estimator of , because this would minimize the residual error [38, Ch. 7]. More specifically, let; we consider two variants of occupancy estimation problem:1)online monitoring;2)offline estimation.We begin by dealing with the first case. At each time instant, we consider a window in the past of   samples of each signal,VIII. CONCLUSION We have proposed methods for estimating occupancy levels in closed environments that exploit different sources of infor-mation. We have aimed at understanding which of such sources are mostly meaningful in addressing the task of estimating how occupancy levels change in time. The main standing assump-tion in our methodology is that it is possible to access to direct measurements of the true occupancy levels for a limited period.The proposed estimation scheme first obtains a dynamic model by a suitable identification method using pilot data. Then, it formulates the occupancy estimation problem as a regularized deconvolution problem (where the regularization exploits prior information on the features of the searched signal). The obtained results show that adding information on ventilation and door opening/closing events can significantly improve the performance of the estimator.We have also analyzed the statistical performance of the esti-mation scheme, showing that the probability of obtaining wrong estimates can be suitably bounded when we know specific de-sign parameters and the measurement noise variance.The proof is divided in three main parts: i) Rewrite (19), de-rive the dual of the rewritten problem and the structure of its so-lution. ii) Find some analytical relations between the estimated and the true occupancy levels. iii) Exploit these relations to de-rive bounds that characterize the statistical performance of the estimator. i): Introduce the variable       and rewrite (19) as where for the purposes of the proof, the function     (the vector-wise rounding operator) is omitted. The Lagrangian of (36) is then where   is the Lagrange multiplier. The dual problem, obtained minimizing   w.r.t.   and  , is [48] We notice that, since   is a lower triangular matrix, it admits an inverse as long as. This is satisfied as soon as there is (only) one delay in the effects of the occupancy on the     levels of the room.To obtain the structure of the dual solution, consider again the derivative of the Lagrangian with respect to  






